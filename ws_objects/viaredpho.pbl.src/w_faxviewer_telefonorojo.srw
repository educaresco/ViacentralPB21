$PBExportHeader$w_faxviewer_telefonorojo.srw
forward
global type w_faxviewer_telefonorojo from pfc_w_master
end type
type st_count from statictext within w_faxviewer_telefonorojo
end type
type cb_rotateright from commandbutton within w_faxviewer_telefonorojo
end type
type ole_signature1 from olecustomcontrol within w_faxviewer_telefonorojo
end type
type st_16 from statictext within w_faxviewer_telefonorojo
end type
type dw_pos from datawindow within w_faxviewer_telefonorojo
end type
type sle_newname from singlelineedit within w_faxviewer_telefonorojo
end type
type st_15 from statictext within w_faxviewer_telefonorojo
end type
type cb_separate from commandbutton within w_faxviewer_telefonorojo
end type
type ole_faxadmin from olecustomcontrol within w_faxviewer_telefonorojo
end type
type st_menurapido from statictext within w_faxviewer_telefonorojo
end type
type st_17 from statictext within w_faxviewer_telefonorojo
end type
type st_14 from statictext within w_faxviewer_telefonorojo
end type
type st_13 from statictext within w_faxviewer_telefonorojo
end type
type st_12 from statictext within w_faxviewer_telefonorojo
end type
type st_11 from statictext within w_faxviewer_telefonorojo
end type
type st_10 from statictext within w_faxviewer_telefonorojo
end type
type st_9 from statictext within w_faxviewer_telefonorojo
end type
type st_8 from statictext within w_faxviewer_telefonorojo
end type
type sle_filter from singlelineedit within w_faxviewer_telefonorojo
end type
type cbx_nosignature from checkbox within w_faxviewer_telefonorojo
end type
type sle_nofax from singlelineedit within w_faxviewer_telefonorojo
end type
type cbx_nofax from checkbox within w_faxviewer_telefonorojo
end type
type st_7 from statictext within w_faxviewer_telefonorojo
end type
type st_3 from statictext within w_faxviewer_telefonorojo
end type
type lb_faxes from listbox within w_faxviewer_telefonorojo
end type
type dw_invoices from datawindow within w_faxviewer_telefonorojo
end type
type lb_firmas from listbox within w_faxviewer_telefonorojo
end type
type cb_zoomin from commandbutton within w_faxviewer_telefonorojo
end type
type sle_zoom from singlelineedit within w_faxviewer_telefonorojo
end type
type cb_zoomout from commandbutton within w_faxviewer_telefonorojo
end type
type sle_selected from singlelineedit within w_faxviewer_telefonorojo
end type
type st_2 from statictext within w_faxviewer_telefonorojo
end type
type cb_ok from commandbutton within w_faxviewer_telefonorojo
end type
type cb_cancel from commandbutton within w_faxviewer_telefonorojo
end type
type gb_2 from groupbox within w_faxviewer_telefonorojo
end type
type cb_rotateleft from commandbutton within w_faxviewer_telefonorojo
end type
type st_branch from statictext within w_faxviewer_telefonorojo
end type
type cb_2 from commandbutton within w_faxviewer_telefonorojo
end type
type cb_rrr from commandbutton within w_faxviewer_telefonorojo
end type
type cb_4 from commandbutton within w_faxviewer_telefonorojo
end type
type em_branch from editmask within w_faxviewer_telefonorojo
end type
type cb_rotate180 from commandbutton within w_faxviewer_telefonorojo
end type
type st_4 from statictext within w_faxviewer_telefonorojo
end type
type st_5 from statictext within w_faxviewer_telefonorojo
end type
type st_6 from statictext within w_faxviewer_telefonorojo
end type
type sle_pos from singlelineedit within w_faxviewer_telefonorojo
end type
type cb_refresh from commandbutton within w_faxviewer_telefonorojo
end type
type cb_printall from commandbutton within w_faxviewer_telefonorojo
end type
type cb_move from commandbutton within w_faxviewer_telefonorojo
end type
type lb_movetofolder from dropdownlistbox within w_faxviewer_telefonorojo
end type
type st_1 from statictext within w_faxviewer_telefonorojo
end type
type gb_1 from groupbox within w_faxviewer_telefonorojo
end type
type gb_3 from groupbox within w_faxviewer_telefonorojo
end type
type gb_4 from groupbox within w_faxviewer_telefonorojo
end type
type gb_5 from groupbox within w_faxviewer_telefonorojo
end type
type p_1 from picture within w_faxviewer_telefonorojo
end type
type ole_fax1 from olecustomcontrol within w_faxviewer_telefonorojo
end type
type em_invoice from editmask within w_faxviewer_telefonorojo
end type
end forward

global type w_faxviewer_telefonorojo from pfc_w_master
integer width = 4585
integer height = 2472
string title = "Red Phone Hold-Faxes"
long backcolor = 80269524
st_count st_count
cb_rotateright cb_rotateright
ole_signature1 ole_signature1
st_16 st_16
dw_pos dw_pos
sle_newname sle_newname
st_15 st_15
cb_separate cb_separate
ole_faxadmin ole_faxadmin
st_menurapido st_menurapido
st_17 st_17
st_14 st_14
st_13 st_13
st_12 st_12
st_11 st_11
st_10 st_10
st_9 st_9
st_8 st_8
sle_filter sle_filter
cbx_nosignature cbx_nosignature
sle_nofax sle_nofax
cbx_nofax cbx_nofax
st_7 st_7
st_3 st_3
lb_faxes lb_faxes
dw_invoices dw_invoices
lb_firmas lb_firmas
cb_zoomin cb_zoomin
sle_zoom sle_zoom
cb_zoomout cb_zoomout
sle_selected sle_selected
st_2 st_2
cb_ok cb_ok
cb_cancel cb_cancel
gb_2 gb_2
cb_rotateleft cb_rotateleft
st_branch st_branch
cb_2 cb_2
cb_rrr cb_rrr
cb_4 cb_4
em_branch em_branch
cb_rotate180 cb_rotate180
st_4 st_4
st_5 st_5
st_6 st_6
sle_pos sle_pos
cb_refresh cb_refresh
cb_printall cb_printall
cb_move cb_move
lb_movetofolder lb_movetofolder
st_1 st_1
gb_1 gb_1
gb_3 gb_3
gb_4 gb_4
gb_5 gb_5
p_1 p_1
ole_fax1 ole_fax1
em_invoice em_invoice
end type
global w_faxviewer_telefonorojo w_faxviewer_telefonorojo

type variables
String   is_faxpath
String   is_signaturespath
Long	  ll_curpage
end variables

forward prototypes
public subroutine fn_loadfax (string ls_filepath)
public subroutine fn_rotatefax (string ls_faxpath, string ls_faxname, integer li_grades)
public subroutine fn_ajustscreen ()
end prototypes

public subroutine fn_loadfax (string ls_filepath);// Loads the fax file!

ole_fax1.object.LoadMultiPage(ls_filepath,1)

// Si tiene usa sola pagina lo lee como imagen (mejor resolucion!)
if ole_fax1.object.GetTotalPage() = 1 then
	ole_fax1.object.FileName = ls_filepath
end if	
end subroutine

public subroutine fn_rotatefax (string ls_faxpath, string ls_faxname, integer li_grades);// USA LA NUEVA FUNCION DE ROTAR UNA SOLA PAGINA, pero por alguna razon aun no funciona!

//integer li_pagetorotate
//
//TRY
//	
//	SetPointer(Hourglass!)
//	
//	//ole_fax1.SetRedraw(false)
//
//
//	if ole_fax1.object.GetTotalPage() > 1 then
//
//		//messagebox("",string(ll_curpage))
//
//		li_pagetorotate = ll_curpage - 1
//
//		if li_grades = 90 then
//			 ole_fax1.object.RotateMultiPageOnly(li_pagetorotate,1)
//		elseif li_grades = 180 then
//			 ole_fax1.object.RotateMultiPageOnly(li_pagetorotate,2)
//		elseif li_grades = 270 then
//			 ole_fax1.object.RotateMultiPageOnly(li_pagetorotate,3)
//		else
//			return
//		end if				
//		 
//	else
//		
//		if li_grades = 90 then
//			ole_fax1.object.Rotate90
//		elseif li_grades = 180 then
//			ole_fax1.object.Rotate180
//		elseif li_grades = 270 then
//			ole_fax1.object.Rotate270
//		else
//			return
//		end if		
//		
////		ole_fax1.object.TIFCompression = 2	
////		ole_fax1.object.Save(ls_originalfile,"TIF")		
//		
//	end if
//
//
//	//ole_fax1.SetRedraw(true)
//	
//	SetPointer(Arrow!)
//	
//	
//CATCH (runtimeerror er)   
//
//   //MessageBox("Runtime Error", er.GetMessage())
//	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!~n~r"+er.GetMessage(),Exclamation!)
//	cb_refresh.TriggerEvent(Clicked!)
//
//FINALLY   
//   	
//	Return
//	
//END TRY 
//

TRY
	
	SetPointer(Hourglass!)
	
	ole_fax1.SetRedraw(false)
	
		
	Integer li_originalpage, li_totalpages
	
	li_originalpage = ll_curpage
	li_totalpages =  ole_fax1.object.GetTotalPage()
	
	
	// Rotates a Fax:
	if li_grades = 90 then
		ole_fax1.object.Rotate90
	elseif li_grades = 180 then
		ole_fax1.object.Rotate180
	elseif li_grades = 270 then
		ole_fax1.object.Rotate270
	else
		return
	end if
	
	// Save the rorate page as JPG in a temp directory
	String ls_newfilename, ls_originalfile, ls_mergedfile
	ls_newfilename = left(ls_faxpath,3) + 'Temp\' + ls_faxname 	
	ls_newfilename = mid(ls_newfilename,1,len(ls_newfilename)-4)
	

	ls_originalfile = ls_newfilename +  '_ori_' + string(now(),'hhmmss')
	ls_mergedfile = ls_newfilename +  '_mer_' + string(now(),'hhmmss')
	ls_newfilename = ls_newfilename +  '_rot_' + string(now(),'hhmmss')
	
	
	ole_fax1.object.TIFCompression = 2	
	//ole_fax1.object.ImageViewer1.JPEGQuality=90
	
	ole_fax1.object.Save(ls_originalfile,"TIF")
	ole_fax1.object.Save(ls_newfilename,"JPG")
	

	// Limpia el objeto
	ole_fax1.object.filename = ''
		
	//	// converts the JGP to TIF!
	ole_fax1.object.RemoveAllTIF()
	ole_fax1.object.AddTIF(ls_newfilename+'.jpg')	
	ole_fax1.object.SaveTIF(ls_newfilename+'.TIF')
	FileDelete(ls_newfilename+'.jpg')
	
	ole_fax1.object.filename = ''
	
	Integer li_return
	
	li_return = ole_fax1.object.TIFMergeMultiFiles(ls_originalfile + '.TIF' + ';' + ls_newfilename+'.TIF', ls_mergedfile+'.TIF',";")
	
	FileDelete(ls_originalfile+'.TIF')
	FileDelete(ls_newfilename+'.TIF')
	
	if li_return <> 1 then	
		return
	end if
	
	ole_fax1.object.TIFSwap(ls_mergedfile+'.TIF',li_originalpage,li_totalpages+1)
	ole_fax1.object.TIFDeletePage (ls_mergedfile+'.TIF', li_totalpages+1)
	
	// keep a copy of the original FAX (before rotation)
	if FileExists(left(ls_faxpath,3)+'Junk\Rotated\' + ls_faxname ) then
		FileDelete(ls_faxpath + ls_faxname)
	else
		fn_FileMove(ls_faxpath + ls_faxname,  left(ls_faxpath,3)+'Junk\Rotated\' + ls_faxname )
	end if
	
	fn_FileMove(ls_mergedfile+'.TIF',ls_faxpath + ls_faxname)
	
	// Loads original multi tiff
	fn_loadfax(ls_faxpath + ls_faxname)	
	fn_ajustscreen()
	
	ole_fax1.SetRedraw(true)
	
	SetPointer(Arrow!)
	
	
CATCH (runtimeerror er)   

   //MessageBox("Runtime Error", er.GetMessage())
	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!~n~r"+er.GetMessage(),Exclamation!)
	cb_refresh.TriggerEvent(Clicked!)

FINALLY   
   	
	Return
	
END TRY 


	
end subroutine

public subroutine fn_ajustscreen ();// after loading a fax, this ajust the screen

ole_fax1.SetRedraw(false)
ole_fax1.visible = false

double ld_current

sle_selected.text = lb_faxes.SelectedItem()

sle_newname.text = sle_selected.text
ld_current=double(sle_zoom.text)
	
ll_curpage = 1
	
sle_pos.text = String(ll_curpage)+"/"+string(ole_fax1.object.GetTotalPage() )
	
// >>>>>>>>>>>>>>>>>>>>>>>>>>>
// Color Number of pages		
if ole_fax1.object.GetTotalPage() > 1 then 
	sle_pos.TextColor	= RGB(255,0,0)	
	cb_separate.enabled = true
else
	sle_pos.TextColor	= RGB(0,0,0)	
	cb_separate.enabled = false
end if

//	// >>>>>>>>>>>>>>>>>>>>>>>>>>>

// Lo pone en el zoom inicial!

//ole_fax1.object.zoomout
//ole_fax1.object.zoomout
//ole_fax1.object.zoomout
//ole_fax1.object.zoomout
//ole_fax1.object.zoomout
//ole_fax1.object.zoomout	
//ole_fax1.object.zoomout	
//ole_fax1.object.zoomout		


// ole_fax1.object.View OPTIONS:
// 1  - 25% image size of original image
// 2  - 33% image size of original image
// 3  - 50% image size of original image
// 4  - 75% image size of original image
// 5  - 100% image size of original image
// 6  - 150% image size of original image
// 7  - 200% image size of original image
// 8  - User define view mode , After select this mode, use ViewSize property to define view size.
// 9  - Fit the image to current display area keep the aspect ratio
//10 - Fit the image to width of current display area.
//11 - Fit the image to height of current display area.
//12 - Center the Image, In this mode, you can't zoom in, zoom out or rotate the image.

ole_fax1.object.View=10
//ole_fax1.object.ViewSize=50 

//messagebox(String(ole_fax1.object.FileWidth),String(ole_fax1.object.FileHeight))

sle_zoom.text = '100'		

cbx_nofax.checked = false
sle_nofax.text = ''	

ole_fax1.SetRedraw(true)
ole_fax1.visible = true

SetFocus(st_menurapido)

end subroutine

on w_faxviewer_telefonorojo.create
int iCurrent
call super::create
this.st_count=create st_count
this.cb_rotateright=create cb_rotateright
this.ole_signature1=create ole_signature1
this.st_16=create st_16
this.dw_pos=create dw_pos
this.sle_newname=create sle_newname
this.st_15=create st_15
this.cb_separate=create cb_separate
this.ole_faxadmin=create ole_faxadmin
this.st_menurapido=create st_menurapido
this.st_17=create st_17
this.st_14=create st_14
this.st_13=create st_13
this.st_12=create st_12
this.st_11=create st_11
this.st_10=create st_10
this.st_9=create st_9
this.st_8=create st_8
this.sle_filter=create sle_filter
this.cbx_nosignature=create cbx_nosignature
this.sle_nofax=create sle_nofax
this.cbx_nofax=create cbx_nofax
this.st_7=create st_7
this.st_3=create st_3
this.lb_faxes=create lb_faxes
this.dw_invoices=create dw_invoices
this.lb_firmas=create lb_firmas
this.cb_zoomin=create cb_zoomin
this.sle_zoom=create sle_zoom
this.cb_zoomout=create cb_zoomout
this.sle_selected=create sle_selected
this.st_2=create st_2
this.cb_ok=create cb_ok
this.cb_cancel=create cb_cancel
this.gb_2=create gb_2
this.cb_rotateleft=create cb_rotateleft
this.st_branch=create st_branch
this.cb_2=create cb_2
this.cb_rrr=create cb_rrr
this.cb_4=create cb_4
this.em_branch=create em_branch
this.cb_rotate180=create cb_rotate180
this.st_4=create st_4
this.st_5=create st_5
this.st_6=create st_6
this.sle_pos=create sle_pos
this.cb_refresh=create cb_refresh
this.cb_printall=create cb_printall
this.cb_move=create cb_move
this.lb_movetofolder=create lb_movetofolder
this.st_1=create st_1
this.gb_1=create gb_1
this.gb_3=create gb_3
this.gb_4=create gb_4
this.gb_5=create gb_5
this.p_1=create p_1
this.ole_fax1=create ole_fax1
this.em_invoice=create em_invoice
iCurrent=UpperBound(this.Control)
this.Control[iCurrent+1]=this.st_count
this.Control[iCurrent+2]=this.cb_rotateright
this.Control[iCurrent+3]=this.ole_signature1
this.Control[iCurrent+4]=this.st_16
this.Control[iCurrent+5]=this.dw_pos
this.Control[iCurrent+6]=this.sle_newname
this.Control[iCurrent+7]=this.st_15
this.Control[iCurrent+8]=this.cb_separate
this.Control[iCurrent+9]=this.ole_faxadmin
this.Control[iCurrent+10]=this.st_menurapido
this.Control[iCurrent+11]=this.st_17
this.Control[iCurrent+12]=this.st_14
this.Control[iCurrent+13]=this.st_13
this.Control[iCurrent+14]=this.st_12
this.Control[iCurrent+15]=this.st_11
this.Control[iCurrent+16]=this.st_10
this.Control[iCurrent+17]=this.st_9
this.Control[iCurrent+18]=this.st_8
this.Control[iCurrent+19]=this.sle_filter
this.Control[iCurrent+20]=this.cbx_nosignature
this.Control[iCurrent+21]=this.sle_nofax
this.Control[iCurrent+22]=this.cbx_nofax
this.Control[iCurrent+23]=this.st_7
this.Control[iCurrent+24]=this.st_3
this.Control[iCurrent+25]=this.lb_faxes
this.Control[iCurrent+26]=this.dw_invoices
this.Control[iCurrent+27]=this.lb_firmas
this.Control[iCurrent+28]=this.cb_zoomin
this.Control[iCurrent+29]=this.sle_zoom
this.Control[iCurrent+30]=this.cb_zoomout
this.Control[iCurrent+31]=this.sle_selected
this.Control[iCurrent+32]=this.st_2
this.Control[iCurrent+33]=this.cb_ok
this.Control[iCurrent+34]=this.cb_cancel
this.Control[iCurrent+35]=this.gb_2
this.Control[iCurrent+36]=this.cb_rotateleft
this.Control[iCurrent+37]=this.st_branch
this.Control[iCurrent+38]=this.cb_2
this.Control[iCurrent+39]=this.cb_rrr
this.Control[iCurrent+40]=this.cb_4
this.Control[iCurrent+41]=this.em_branch
this.Control[iCurrent+42]=this.cb_rotate180
this.Control[iCurrent+43]=this.st_4
this.Control[iCurrent+44]=this.st_5
this.Control[iCurrent+45]=this.st_6
this.Control[iCurrent+46]=this.sle_pos
this.Control[iCurrent+47]=this.cb_refresh
this.Control[iCurrent+48]=this.cb_printall
this.Control[iCurrent+49]=this.cb_move
this.Control[iCurrent+50]=this.lb_movetofolder
this.Control[iCurrent+51]=this.st_1
this.Control[iCurrent+52]=this.gb_1
this.Control[iCurrent+53]=this.gb_3
this.Control[iCurrent+54]=this.gb_4
this.Control[iCurrent+55]=this.gb_5
this.Control[iCurrent+56]=this.p_1
this.Control[iCurrent+57]=this.ole_fax1
this.Control[iCurrent+58]=this.em_invoice
end on

on w_faxviewer_telefonorojo.destroy
call super::destroy
destroy(this.st_count)
destroy(this.cb_rotateright)
destroy(this.ole_signature1)
destroy(this.st_16)
destroy(this.dw_pos)
destroy(this.sle_newname)
destroy(this.st_15)
destroy(this.cb_separate)
destroy(this.ole_faxadmin)
destroy(this.st_menurapido)
destroy(this.st_17)
destroy(this.st_14)
destroy(this.st_13)
destroy(this.st_12)
destroy(this.st_11)
destroy(this.st_10)
destroy(this.st_9)
destroy(this.st_8)
destroy(this.sle_filter)
destroy(this.cbx_nosignature)
destroy(this.sle_nofax)
destroy(this.cbx_nofax)
destroy(this.st_7)
destroy(this.st_3)
destroy(this.lb_faxes)
destroy(this.dw_invoices)
destroy(this.lb_firmas)
destroy(this.cb_zoomin)
destroy(this.sle_zoom)
destroy(this.cb_zoomout)
destroy(this.sle_selected)
destroy(this.st_2)
destroy(this.cb_ok)
destroy(this.cb_cancel)
destroy(this.gb_2)
destroy(this.cb_rotateleft)
destroy(this.st_branch)
destroy(this.cb_2)
destroy(this.cb_rrr)
destroy(this.cb_4)
destroy(this.em_branch)
destroy(this.cb_rotate180)
destroy(this.st_4)
destroy(this.st_5)
destroy(this.st_6)
destroy(this.sle_pos)
destroy(this.cb_refresh)
destroy(this.cb_printall)
destroy(this.cb_move)
destroy(this.lb_movetofolder)
destroy(this.st_1)
destroy(this.gb_1)
destroy(this.gb_3)
destroy(this.gb_4)
destroy(this.gb_5)
destroy(this.p_1)
destroy(this.ole_fax1)
destroy(this.em_invoice)
end on

event open;call super::open;String ls_faxserver, ls_imageviewerlicense

//ole_fax1.object.LicenseKey ="10580"
//ole_signature1.object.LicenseKey ="10580"


ls_imageviewerlicense = fn_busparameter("IVP_LICENSE")

ole_fax1.object.LicenseKey = ls_imageviewerlicense
ole_signature1.object.LicenseKey = ls_imageviewerlicense


//MouseTrackMode
//0 - Draw Selection Rectangle + Panning + Auto Zoom.
//1 - Draw Selection Rectangle + Panning
//2 - Right Mouse Panning Only
//3 - Nothing
//4 - Left Mouse Panning Only

ole_fax1.object.MouseTrackMode=4
ole_signature1.object.MouseTrackMode=4

ls_faxserver = fn_busparameter("FAXSERVER")

if isnull(ls_faxserver) or len(trim(ls_faxserver)) < 1 then ls_faxserver = 'Faxserver01'

X=1
Y=1

lb_movetofolder.text = "Junk"

if not fileexists("u:\RedPhone") then
	fn_mapnetworkdrive("u","\\"+ls_faxserver+"\Faxes")
end if

if not fileexists("u:\RedPhone") then
	messagebox("Error","The fax' folder cannot be mapped.~nPlease map the network drive manually.",StopSign!)
	close(this)
	return	
end if

is_faxpath = "u:\RedPhone\"
is_signaturespath = "U:\RP-FirmasAutorizadas\"

lb_faxes.DirList(is_faxpath + "*.TIF", 0)

dw_pos.retrieve()
dw_invoices.retrieve()
st_count.text = String(dw_invoices.rowcount())


end event

event key;call super::key;integer li_next

IF keyflags = 0 THEN

	IF key = KeyF9! THEN
		// Selecciona el siguiente registro del listbox
		if lb_faxes.totalitems() > 0 then
			li_next = lb_faxes.selectedindex() + 1
			if lb_faxes.selectedindex() <= 0 or lb_faxes.selectedindex() >= lb_faxes.totalitems() then li_next = 1			
			lb_faxes.SelectItem(li_next)
			lb_faxes.triggerEvent(SelectionChanged!)
		end if
		SetFocus(st_menurapido)		
	ELSEIF key = KeyF5! THEN		
		cb_rotateleft.TriggerEvent(Clicked!)
		SetFocus(st_menurapido)
	ELSEIF key = KeyF6! THEN		
		cb_rotateright.TriggerEvent(Clicked!)				
		SetFocus(st_menurapido)
	ELSEIF key = KeyF7! THEN
		cb_zoomin.TriggerEvent(Clicked!)
		SetFocus(st_menurapido)
	ELSEIF key = KeyF8! THEN
		cb_zoomout.TriggerEvent(Clicked!)	
		SetFocus(st_menurapido)
	ELSEIF key = KeyF11! THEN
		SetFocus(sle_filter)
	ELSEIF key = KeyF12! THEN
		cb_ok.TriggerEvent(Clicked!)		
		SetFocus(st_menurapido)
   END IF
		
END IF
end event

type st_count from statictext within w_faxviewer_telefonorojo
integer x = 558
integer y = 996
integer width = 123
integer height = 56
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "000"
alignment alignment = right!
boolean focusrectangle = false
end type

type cb_rotateright from commandbutton within w_faxviewer_telefonorojo
integer x = 4379
integer y = 480
integer width = 101
integer height = 72
integer taborder = 20
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = ">"
end type

event clicked;TRY

	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
		MessageBox("Error","The file was already moved",StopSign!)
		cb_refresh.triggerEvent(Clicked!)
		return
	end if
		
	fn_rotatefax(is_faxpath,lb_faxes.SelectedItem(),90)	
	
//	ole_fax1.object.Rotate90
//	
//	String ls_newfilename	
//	ls_newfilename = is_faxpath + 'temp\' + lb_faxes.SelectedItem()
//	ls_newfilename = mid(ls_newfilename,1,len(ls_newfilename)-4)	
//	//ole_fax1.object.TIFCompression = 2	
//	//ole_fax1.object.ImageViewer1.JPEGQuality=90
//	ole_fax1.object.Save(ls_newfilename,"JPG")
//	
//	//ole_fax1.object.SaveTIF(ls_newfilename)
//	
//	//fn_loadfax(ls_newfilename)
	
CATCH (runtimeerror er)   

	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
	cb_refresh.TriggerEvent(Clicked!)

FINALLY   
   	
	Return
	
END TRY 




//TRY
//
//	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
//		MessageBox("Error","The file was already moved",StopSign!)
//		cb_refresh.triggerEvent(Clicked!)
//		return
//	end if
//	
//	if isnull(ole_fax.object.image) or len(trim(string(ole_fax.object.image))) < 1 then
//		return
//	end if
//	
//	ole_fax.object.RotateRight
//	ole_fax.object.Save
//	
//CATCH (runtimeerror er)   
//
//   //MessageBox("Runtime Error", er.GetMessage())
//	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
//	cb_refresh.TriggerEvent(Clicked!)
//
//FINALLY   
//   	
//	Return
//	
//END TRY 
end event

type ole_signature1 from olecustomcontrol within w_faxviewer_telefonorojo
event click ( )
event dblclick ( )
event mousemove ( integer button,  integer shift,  long ocx_x,  long ocx_y )
event mousedown ( integer button,  integer shift,  long ocx_x,  long ocx_y )
event mouseup ( integer button,  integer shift,  long ocx_x,  long ocx_y )
event keydown ( integer keycode,  integer shift )
event keyup ( integer keycode,  integer shift )
event keypress ( integer keyascii )
event selectionrectdrawn ( long ileft,  long itop,  long iwidth,  long iheight )
event ocrrecognized ( boolean bsuccess )
integer x = 2222
integer y = 1840
integer width = 1627
integer height = 456
boolean border = false
long backcolor = 16777215
boolean focusrectangle = false
string binarykey = "w_faxviewer_telefonorojo.win"
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
end type

type st_16 from statictext within w_faxviewer_telefonorojo
integer x = 27
integer y = 996
integer width = 471
integer height = 56
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
boolean enabled = false
string text = "Ordenes Disponibles:"
boolean focusrectangle = false
end type

type dw_pos from datawindow within w_faxviewer_telefonorojo
integer x = 9
integer y = 2004
integer width = 690
integer height = 292
integer taborder = 60
string title = "none"
string dataobject = "dw_invoices_hold_pos"
boolean livescroll = true
end type

event constructor;SetTransObject(SQLCA)
end event

type sle_newname from singlelineedit within w_faxviewer_telefonorojo
integer x = 4187
integer y = 1228
integer width = 283
integer height = 76
integer taborder = 30
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 16777215
textcase textcase = upper!
borderstyle borderstyle = stylelowered!
end type

type st_15 from statictext within w_faxviewer_telefonorojo
integer x = 4059
integer y = 1244
integer width = 160
integer height = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
boolean enabled = false
string text = "Nom:"
boolean focusrectangle = false
end type

type cb_separate from commandbutton within w_faxviewer_telefonorojo
integer x = 4064
integer y = 820
integer width = 425
integer height = 88
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Separar Paginas"
end type

event clicked;
SetPointer(HourGlass!)

TRY

	double ld_current
	String ls_temp_name, ls_temp_name_base, ls_temp_out1, ls_temp_out2
	Integer li_page, li_pages
	
	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
		MessageBox("Error","The file was already moved",StopSign!)
		cb_refresh.triggerEvent(Clicked!)
		return
	end if
	
	ole_fax1.object.LoadMultiPage( is_faxpath+lb_faxes.SelectedItem(),1)
	
	// Si tiene usa sola pagina lo lee como imagen (mejor resolucion!)
	if ole_fax1.object.GetTotalPage() = 1 then
		ole_fax1.object.FileName = is_faxpath+lb_faxes.SelectedItem()
		Messagebox("Error!","El fax seleccionado solo tiene una pagina!")
		return		
	end if	

	li_pages= ole_fax1.object.GetTotalPage() 

	if li_pages > 50 then		
		Messagebox("Error!","Esta funcion solo funciona hasta 50 paginas!")
		return		
	end if

	ls_temp_name_base = fn_replace(upper(lb_faxes.SelectedItem()),'.TIF','_P'+String(li_pages)+'x')

	fn_FileMove(is_faxpath+lb_faxes.SelectedItem(),is_faxpath+ls_temp_name_base+'.TIF')
	
	for li_page = 1 to (li_pages - 1)
		
		// Quita el ultimo digito
		//ls_temp_name = mid(ls_temp_name_base,1,len(ls_temp_name_base) - 2)
		
		ls_temp_name = mid(ls_temp_name_base,1,pos(ls_temp_name_base,'_P') + 1)
		
		
		//ls_temp_name_new_base = mid(ls_temp_name_base,1,len(ls_temp_name_base) - 2)
		
		if (li_pages - li_page) = 1 then
			ls_temp_out1 = is_faxpath + ls_temp_name + String(li_pages - li_page) + '.TIF'
		else 
			ls_temp_out1 = is_faxpath + ls_temp_name + String(li_pages - li_page) + 'x.TIF'	
		end if		
		ls_temp_out2 = is_faxpath + ls_temp_name + String(li_pages + 1 - li_page) + '.TIF'
				
		ole_fax1.object.TIFSplit (is_faxpath + ls_temp_name_base+'.TIF',(li_pages + 1 - li_page),ls_temp_out1,ls_temp_out2)

		FileDelete(is_faxpath + ls_temp_name_base+'.TIF')

		ls_temp_name_base = ls_temp_name+String(li_pages - li_page)+'x'
			
	next				

	Messagebox("Process Complete","Las "+string(li_pages)+" han sido separadas, la lista de faxes sera actualizada!")
	cb_refresh.TriggerEvent(Clicked!)

CATCH (runtimeerror er)   

   //MessageBox("Runtime Error", er.GetMessage())
	Messagebox("Error (try block)","El fax seleccionado fue movido, la lista sera actualizada! "+er.text,Exclamation!)
	cb_refresh.TriggerEvent(Clicked!)

FINALLY   

	SetPointer(Arrow!)

	Return

END TRY 







//SetPointer(HourGlass!)
//
//TRY
//
//	double ld_current
//	String ls_temp_name, ls_temp_name_base, ls_temp_out1, ls_temp_out2
//	Integer li_page, li_pages
//	
//	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
//		MessageBox("Error","The file was already moved",StopSign!)
//		cb_refresh.triggerEvent(Clicked!)
//		return
//	end if
//	
//	ole_fax1.object.LoadMultiPage( is_faxpath+lb_faxes.SelectedItem(),1)
//	
//	// Si tiene usa sola pagina lo lee como imagen (mejor resolucion!)
//	if ole_fax1.object.GetTotalPage() = 1 then
//		ole_fax1.object.FileName = is_faxpath+lb_faxes.SelectedItem()
//		Messagebox("Error!","El fax seleccionado solo tiene una pagina!")
//		return		
//	end if	
//
//	li_pages= ole_fax1.object.GetTotalPage() 
//
//	if li_pages > 19 then		
//		Messagebox("Error!","Esta funcion solo funciona hasta 19 paginas!")
//		return		
//	end if
//
//	ls_temp_name_base = fn_replace(upper(lb_faxes.SelectedItem()),'.TIF','_P'+String(li_pages)+'x')
//
//	fn_FileMove(is_faxpath+lb_faxes.SelectedItem(),is_faxpath+ls_temp_name_base+'.TIF')
//	
//	for li_page = 1 to (li_pages - 1)
//		
//		// Quita el ultimo digito
//		ls_temp_name = mid(ls_temp_name_base,1,len(ls_temp_name_base) - 2)
//		//ls_temp_name_new_base = mid(ls_temp_name_base,1,len(ls_temp_name_base) - 2)
//		
//		if (li_pages - li_page) = 1 then
//			ls_temp_out1 = is_faxpath + ls_temp_name + String(li_pages - li_page) + '.TIF'
//		else 
//			ls_temp_out1 = is_faxpath + ls_temp_name + String(li_pages - li_page) + 'x.TIF'	
//		end if		
//		ls_temp_out2 = is_faxpath + ls_temp_name + String(li_pages + 1 - li_page) + '.TIF'
//				
//		ole_fax1.object.TIFSplit (is_faxpath + ls_temp_name_base+'.TIF',(li_pages + 1 - li_page),ls_temp_out1,ls_temp_out2)
//
//		FileDelete(is_faxpath + ls_temp_name_base+'.TIF')
//
//		ls_temp_name_base = ls_temp_name+String(li_pages - li_page)+'x'
//			
//	next				
//
//	Messagebox("Process Complete","Las "+string(li_pages)+" han sido separadas, la lista de faxes sera actualizada!")
//	cb_refresh.TriggerEvent(Clicked!)
//
//CATCH (runtimeerror er)   
//
//   //MessageBox("Runtime Error", er.GetMessage())
//	Messagebox("Error (try block)","El fax seleccionado fue movido, la lista sera actualizada! "+er.text,Exclamation!)
//	cb_refresh.TriggerEvent(Clicked!)
//
//FINALLY   
//
//	SetPointer(Arrow!)
//
//	Return
//
//END TRY 
end event

type ole_faxadmin from olecustomcontrol within w_faxviewer_telefonorojo
integer x = 4517
integer y = 2392
integer width = 155
integer height = 136
integer taborder = 40
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
string binarykey = "w_faxviewer_telefonorojo.win"
integer binaryindex = 1
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
end type

type st_menurapido from statictext within w_faxviewer_telefonorojo
integer x = 4059
integer y = 1560
integer width = 453
integer height = 52
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Teclas Rápidas"
boolean focusrectangle = false
end type

type st_17 from statictext within w_faxviewer_telefonorojo
integer x = 4059
integer y = 1864
integer width = 453
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "F11 : Ir al filtro"
boolean focusrectangle = false
end type

type st_14 from statictext within w_faxviewer_telefonorojo
integer x = 4059
integer y = 1672
integer width = 453
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "F6 : Rotar Der."
boolean focusrectangle = false
end type

type st_13 from statictext within w_faxviewer_telefonorojo
integer x = 4059
integer y = 1624
integer width = 453
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "F5 : Rotar Izq."
boolean focusrectangle = false
end type

type st_12 from statictext within w_faxviewer_telefonorojo
integer x = 4059
integer y = 1768
integer width = 453
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "F8 : Zoom Out"
boolean focusrectangle = false
end type

type st_11 from statictext within w_faxviewer_telefonorojo
integer x = 4059
integer y = 1720
integer width = 453
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "F7 : Zoom In"
boolean focusrectangle = false
end type

type st_10 from statictext within w_faxviewer_telefonorojo
integer x = 4059
integer y = 1816
integer width = 453
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "F9 : Siguiente Fax"
boolean focusrectangle = false
end type

type st_9 from statictext within w_faxviewer_telefonorojo
integer x = 4059
integer y = 1912
integer width = 453
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "F12 : Proc./Liberar"
boolean focusrectangle = false
end type

type st_8 from statictext within w_faxviewer_telefonorojo
integer x = 27
integer y = 1840
integer width = 133
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Filtro:"
boolean focusrectangle = false
end type

type sle_filter from singlelineedit within w_faxviewer_telefonorojo
integer x = 160
integer y = 1832
integer width = 521
integer height = 76
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
textcase textcase = upper!
borderstyle borderstyle = stylelowered!
end type

event modified;String ls_filter

if trim(this.text) = '' then 
	ls_filter = ''
else
	//ls_filter = " trim( receiver_id_branch )+'-'+string( receiver_id_receiver ) like '%_"+ Mid( this.text, 2) +"%'"
	ls_filter = " trim( id_branch )+'-'+string( id_receiver ) like '%_"+ Mid( this.text, 2) +"%'"
end if

dw_invoices.SetFilter(ls_filter)
dw_invoices.Filter( )


end event

type cbx_nosignature from checkbox within w_faxviewer_telefonorojo
integer x = 750
integer y = 2216
integer width = 750
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "No hay firma / No Coincide"
end type

event clicked;if this.checked then
	// refrescar las firmas! -- Para limpiar si hay algo seleccionado
	//ole_signature.object.ClearDisplay()
	ole_signature1.object.FileName = ""
	
	if trim(em_branch.text) = '' then
		// Limpia el cuadro
		lb_firmas.DirList(is_signaturespath + "ASDFASDF*.bmp", 0)
	else		
		lb_firmas.DirList(is_signaturespath + trim(em_branch.text) + "*.bmp", 0)	
	end if
		
end if
end event

type sle_nofax from singlelineedit within w_faxviewer_telefonorojo
integer x = 18
integer y = 888
integer width = 663
integer height = 76
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
textcase textcase = upper!
integer limit = 45
borderstyle borderstyle = stylelowered!
end type

type cbx_nofax from checkbox within w_faxviewer_telefonorojo
integer x = 18
integer y = 832
integer width = 517
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "No hay fax. Razon:"
end type

event clicked;if this.checked then
	
	lb_faxes.DirList(is_faxpath + "*.TIF", 0)
	
	// >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
	// Cleaning Screen
	sle_pos.TextColor	= RGB(0,0,0)
	sle_pos.text = "1/1"
	sle_zoom.text = '50'
	sle_selected.text = "[No Fax Selected]"
	ole_fax1.object.FileName = ""
	// >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
	
end if
end event

type st_7 from statictext within w_faxviewer_telefonorojo
integer x = 27
integer y = 116
integer width = 416
integer height = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
boolean enabled = false
string text = "Faxes Disponibles:"
boolean focusrectangle = false
end type

type st_3 from statictext within w_faxviewer_telefonorojo
integer x = 23
integer y = 1944
integer width = 471
integer height = 56
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
boolean enabled = false
string text = "Ordenes POS:"
boolean focusrectangle = false
end type

type lb_faxes from listbox within w_faxviewer_telefonorojo
integer x = 18
integer y = 176
integer width = 663
integer height = 648
integer taborder = 10
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean hscrollbar = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;
String ls_faxname
String ls_faxbranch, ls_faxnumber

TRY

	
	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
		MessageBox("Error","The file was already moved",StopSign!)
		cb_refresh.triggerEvent(Clicked!)
		return
	end if	
	
	
	ole_fax1.object.FileName = ''


	


	
	// <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
	// 06/28/2012 -> filter the orders base on the fax caller id
	ls_faxname = lb_faxes.SelectedItem()
	ls_faxname = fn_replace(upper(ls_faxname),'.TIF','')
	
		
	SetNull(ls_faxbranch)
	
	// OpenText Lookup
	
	SetNull(ls_faxnumber)
	
	ls_faxnumber = fn_token(ls_faxname,"_",2)
	
	if len(ls_faxnumber)>9 then

		select b.id_branch
		into :ls_faxbranch 
		from dba.BRANCH b, dba.TIPO_TRANSMISION_AGENCIA x
		where x.ID_BRANCH = b.ID_BRANCH 
		and id_status_branch = 'O'
		and (right(:ls_faxnumber,10) = b.FAX_BRANCH or right(:ls_faxnumber,10) = b.PHONE2_BRANCH or right(:ls_faxnumber,10) = b.PHONE1_BRANCH )
		order by id_flag_branch;
		
		if not isnull(ls_faxbranch) then
			sle_filter.text = ls_faxbranch
		end if
	
	end if
	
	
	
	// ActiveFax Lookup
	if isnull(ls_faxbranch) then
		
		if pos(ls_faxname,"_")>0 then
			ls_faxname = left(ls_faxname,pos(ls_faxname,"_")-1)
			//messagebox("",ls_faxname)
		end if
		
		select b.id_branch
		into :ls_faxbranch 
		from dba.faxprotocol f, dba.BRANCH b, dba.TIPO_TRANSMISION_AGENCIA x
		where x.ID_BRANCH = b.ID_BRANCH 
		and right(f.faxnumber,10) = b.FAX_BRANCH 
		and FaxId = :ls_faxname
		and id_status_branch = 'O'
		order by id_flag_branch;
		
		if not isnull(ls_faxbranch) then
			sle_filter.text = ls_faxbranch
		else
	
			// busca si llego desde phone2
			select b.id_branch
			into :ls_faxbranch 
			from dba.faxprotocol f, dba.BRANCH b, dba.TIPO_TRANSMISION_AGENCIA x
			where x.ID_BRANCH = b.ID_BRANCH 
			and right(f.faxnumber,10) = b.PHONE2_BRANCH 
			and FaxId = :ls_faxname
			and id_status_branch = 'O'
			order by id_flag_branch;
				
			if not isnull(ls_faxbranch) then
				sle_filter.text = ls_faxbranch
			else
		
				// busca si llego desde phone1
				select b.id_branch
				into :ls_faxbranch 
				from dba.faxprotocol f, dba.BRANCH b, dba.TIPO_TRANSMISION_AGENCIA x
				where x.ID_BRANCH = b.ID_BRANCH 
				and right(f.faxnumber,10) = b.PHONE1_BRANCH 
				and FaxId = :ls_faxname
				and id_status_branch = 'O'
				order by id_flag_branch;
					
				if not isnull(ls_faxbranch) then
					sle_filter.text = ls_faxbranch
				else
					sle_filter.text = ""
				end if
				
			end if
		
		end if
		
	end if
	
	
	sle_filter.triggerevent(modified!)
	// <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
	


	ole_fax1.SetRedraw(false)
	fn_loadfax(is_faxpath+lb_faxes.SelectedItem())	
	fn_ajustscreen()
	ole_fax1.SetRedraw(true)
	
	SetFocus(st_menurapido)
	
CATCH (runtimeerror er)   

   //MessageBox("Runtime Error", er.GetMessage())
	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!~n~r"+er.GetMessage(),Exclamation!)
	cb_refresh.TriggerEvent(Clicked!)

FINALLY   
   	
	Return
	
END TRY 






//TRY
//
//	double ld_current
//	
//	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
//		MessageBox("Error","The file was already moved",StopSign!)
//		cb_refresh.triggerEvent(Clicked!)
//		return
//	end if
//	
//	ole_fax.object.image = is_faxpath+lb_faxes.SelectedItem()
//	sle_selected.text = lb_faxes.SelectedItem()
//	sle_newname.text = sle_selected.text
//	ld_current=double(sle_zoom.text)
//	ole_fax.object.zoom = ld_current
//	ole_fax.object.Page = 1
//	ole_fax.object.display
//	
//	sle_pos.text = String(ole_fax.object.Page)+"/"+string(ole_fax.object.PageCount)
//	
//	// >>>>>>>>>>>>>>>>>>>>>>>>>>>
//	// Color Number of pages
//	sle_pos.TextColor	= RGB(0,0,0)
//	cb_separate.enabled = false
//	if ole_fax.object.PageCount > 1 then 
//		sle_pos.TextColor	= RGB(255,0,0)	
//		cb_separate.enabled = true
//	end if
//	// >>>>>>>>>>>>>>>>>>>>>>>>>>>
//	
//	ole_fax.object.zoom = 50
//	sle_zoom.text = '50'
//	ole_fax.object.display
//	
//	cbx_nofax.checked = false
//	sle_nofax.text = ''
//
//CATCH (runtimeerror er)   
//
//   //MessageBox("Runtime Error", er.GetMessage())
//	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
//	cb_refresh.TriggerEvent(Clicked!)
//
//FINALLY   
//   	
//	Return
//	
//END TRY 
//
//
end event

type dw_invoices from datawindow within w_faxviewer_telefonorojo
event ue_keyup pbm_keyup
integer x = 18
integer y = 1052
integer width = 663
integer height = 772
integer taborder = 20
string dataobject = "dw_invoices_hold_telefono_sp"
boolean hscrollbar = true
boolean vscrollbar = true
boolean livescroll = true
end type

event ue_keyup;//integer li_next
//
//IF keyflags = 0 THEN
//
//	IF key = KeyF9! THEN
//		// Selecciona el siguiente registro del listbox
//		if lb_faxes.totalitems() > 0 then
//			li_next = lb_faxes.selectedindex() + 1
//			if lb_faxes.selectedindex() <= 0 or lb_faxes.selectedindex() >= lb_faxes.totalitems() then li_next = 1			
//			lb_faxes.SelectItem(li_next)
//			lb_faxes.triggerEvent(SelectionChanged!)
//		end if
//	ELSEIF key = KeyF5! THEN		
//		cb_rotateleft.TriggerEvent(Clicked!)
//	ELSEIF key = KeyF6! THEN		
//		cb_rotateright.TriggerEvent(Clicked!)				
//	ELSEIF key = KeyF7! THEN
//		cb_zoomin.TriggerEvent(Clicked!)
//	ELSEIF key = KeyF8! THEN
//		cb_zoomout.TriggerEvent(Clicked!)	
////	ELSEIF key = KeyF10! THEN
////		// Selecciona el siguiente registro del listbox		
////		if lb_firmas.totalitems() > 0 then
////			li_next = lb_firmas.selectedindex() + 1
////			if lb_firmas.selectedindex() <= 0 or lb_firmas.selectedindex() >= lb_firmas.totalitems() then li_next = 1			
////			lb_firmas.SelectItem(li_next)						
////			lb_firmas.triggerEvent(SelectionChanged!)
////		end if		
//	ELSEIF key = KeyF11! THEN
//		SetFocus(sle_filter)
//	ELSEIF key = KeyF12! THEN
//		cb_ok.TriggerEvent(Clicked!)		
//   END IF
//
//END IF
end event

event constructor;SetTransObject(SQLCA)
end event

event clicked;long 		ll_row
string 	ls_id_branch
double 	ld_id_receiver

ll_row = this.GetClickedRow()

if row = 0 then row = ll_row

if ll_row >  0 then

	//ls_id_branch 	= this.getitemstring(ll_row,"receiver_id_branch")
	//ld_id_receiver = this.getitemnumber(ll_row,"receiver_id_receiver")
	ls_id_branch 	= this.getitemstring(ll_row,"id_branch")
	ld_id_receiver = this.getitemnumber(ll_row,"id_receiver")


	em_branch.text = ls_id_branch
	em_invoice.text = string(ld_id_receiver)
	
	// refrescar las firmas!
	ole_signature1.object.FileName = ""
	lb_firmas.DirList(is_signaturespath + trim(ls_id_branch) + "*.bmp", 0)		
			
	if lb_firmas.TotalItems() > 0 then
		cbx_nosignature.checked = false
	else
		cbx_nosignature.checked = true
	end if	
	
	this.SelectRow(0, FALSE)
	this.SelectRow(ll_row, TRUE)

else

	this.SelectRow(0, FALSE)
	em_branch.text = ''
	em_invoice.text = ''

end if
end event

type lb_firmas from listbox within w_faxviewer_telefonorojo
integer x = 750
integer y = 1920
integer width = 1435
integer height = 296
integer taborder = 50
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean hscrollbar = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;
TRY
	
	if not fileexists(is_signaturespath+lb_firmas.SelectedItem()) then
		MessageBox("Error","The file was already moved",StopSign!)
		cb_refresh.triggerEvent(Clicked!)
		return
	end if
	
	//	ole_signature.object.image = is_signaturespath+lb_firmas.SelectedItem()
	//	ole_signature.object.display

	ole_signature1.object.FileName = is_signaturespath+lb_firmas.SelectedItem()
	
	cbx_nosignature.checked = false

CATCH (runtimeerror er)   

   //MessageBox("Runtime Error", er.GetMessage())
	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
	cb_refresh.TriggerEvent(Clicked!)

FINALLY   

	return

END TRY


end event

type cb_zoomin from commandbutton within w_faxviewer_telefonorojo
integer x = 4165
integer y = 596
integer width = 101
integer height = 72
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "+"
end type

event clicked;TRY

	double ld_current
	
	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
		MessageBox("Error","The file was already moved",StopSign!)
		cb_refresh.triggerEvent(Clicked!)
		return
	end if	
		
	ld_current=double(sle_zoom.text)
	
	if ld_current < 200 then
		ole_fax1.object.Zoomin
		sle_zoom.text = string(ld_current + 5)
	end if
	
CATCH (runtimeerror er)   

	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
	cb_refresh.TriggerEvent(Clicked!)

FINALLY   
   	
	Return
	
END TRY 





//TRY
//
//	double ld_current
//	
//	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
//		MessageBox("Error","The file was already moved",StopSign!)
//		cb_refresh.triggerEvent(Clicked!)
//		return
//	end if
//	
//	if isnull(ole_fax.object.image) or len(trim(string(ole_fax.object.image))) < 1 then
//		return
//	end if
//	
//	ld_current=double(sle_zoom.text)
//	
//	if ld_current < 300 then
//		ole_fax.object.zoom = ld_current + 10
//		sle_zoom.text = string(ld_current + 10)
//		ole_fax.object.display
//	end if
//	
//CATCH (runtimeerror er)   
//
//   //MessageBox("Runtime Error", er.GetMessage())
//	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
//	cb_refresh.TriggerEvent(Clicked!)
//
//FINALLY   
//   	
//	Return
//	
//END TRY 
end event

type sle_zoom from singlelineedit within w_faxviewer_telefonorojo
integer x = 4265
integer y = 596
integer width = 114
integer height = 72
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 16777215
string text = "100"
boolean autohscroll = false
boolean displayonly = true
end type

type cb_zoomout from commandbutton within w_faxviewer_telefonorojo
integer x = 4379
integer y = 596
integer width = 101
integer height = 72
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "-"
end type

event clicked;TRY

	double ld_current
	
	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
		MessageBox("Error","The file was already moved",StopSign!)
		cb_refresh.triggerEvent(Clicked!)
		return
	end if
	
	ld_current=double(sle_zoom.text)
	
	if ld_current > 10 then
		ole_fax1.object.Zoomout
		sle_zoom.text = string(ld_current - 5)
	end if
	
CATCH (runtimeerror er)   

	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
	cb_refresh.TriggerEvent(Clicked!)

FINALLY   
   	
	Return
	
END TRY 



//TRY
//
//	double ld_current
//	
//	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
//		MessageBox("Error","The file was already moved",StopSign!)
//		cb_refresh.triggerEvent(Clicked!)
//		return
//	end if
//	
//	if isnull(ole_fax.object.image) or len(trim(string(ole_fax.object.image))) < 1 then
//		return
//	end if
//	
//	ld_current=double(sle_zoom.text)
//	
//	if ld_current > 10 then
//		ole_fax.object.zoom = ld_current - 10
//		sle_zoom.text = string(ld_current - 10)
//		ole_fax.object.display
//	end if
//	
//CATCH (runtimeerror er)   
//
//   //MessageBox("Runtime Error", er.GetMessage())
//	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
//	cb_refresh.TriggerEvent(Clicked!)
//
//FINALLY   
//   	
//	Return
//	
//END TRY 	
end event

type sle_selected from singlelineedit within w_faxviewer_telefonorojo
integer x = 3863
integer y = 2064
integer width = 631
integer height = 76
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 80269524
boolean autohscroll = false
boolean displayonly = true
borderstyle borderstyle = stylelowered!
end type

type st_2 from statictext within w_faxviewer_telefonorojo
integer x = 745
integer y = 1860
integer width = 517
integer height = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
boolean enabled = false
string text = "Firmas Autorizadas:"
boolean focusrectangle = false
end type

type cb_ok from commandbutton within w_faxviewer_telefonorojo
integer x = 3863
integer y = 2168
integer width = 631
integer height = 124
integer taborder = 80
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "&Procesar y Liberar"
end type

event clicked;Long ll_cont
String ls_selected, ls_branch, ls_invoice
Double ld_receiver, ld_sender
String ls_faxpath, ls_faxname, ls_newfaxfolder, ls_newfaxname
String ls_signaturefilename
String ls_current_flag, ls_desc_release
Integer li_selected_index

//()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()
// Valida el Envio
ls_branch = em_branch.text
ls_invoice = em_invoice.text
if isnull(ls_branch) then ls_branch = ''
if isnull(ls_invoice) then ls_invoice = '0'
ld_receiver = double(ls_invoice)


// it is a TOPUP PIN
if left(ls_branch,1) = 'R' then
		
	SELECT count(*)
	into :ll_cont	
	FROM DBA.VCW_SALES_PRODUCTS S
	WHERE STATUSID = 'H'
	AND S.IDBRANCH = :ls_branch
	AND S.SALESID = :ld_receiver;
	
else
	
	// CHANGED TABLED ORDER  added 06/27/2013 (it was RECEIVER, SENDER, MOTIVO before)
	SELECT count(*) 
	into :ll_cont
	FROM dba.SENDER WITH (NOLOCK),  
	DBA.RECEIVER WITH (NOLOCK),   	 
	dba.MOTIVO_HOLD WITH (NOLOCK)
	WHERE DBA.SENDER.ID_SENDER = DBA.RECEIVER.ID_SENDER
	AND DBA.RECEIVER.ID_BRANCH = dba.SENDER.ID_BRANCH
	AND dba.MOTIVO_HOLD.ID_SENDER = DBA.RECEIVER.ID_SENDER
	AND DBA.RECEIVER.ID_BRANCH = dba.MOTIVO_HOLD.ID_BRANCH 
	AND dba.MOTIVO_HOLD.ID_RECEIVER = DBA.RECEIVER.ID_RECEIVER
	AND DBA.RECEIVER.ID_BRANCH = :ls_branch
	AND DBA.RECEIVER.ID_RECEIVER = :ld_receiver
	AND DBA.RECEIVER.ID_FLAG_RECEIVER = 'H' 
	AND dba.MOTIVO_HOLD.TYPE_MOTIVO_HOLD = '70';

end if
	

if ll_cont < 1 then 
	Messagebox("Envio no encontrado","Debe seleccionar un envio de la lista.",StopSign!)
	SetFocus(dw_invoices)
	return
end if
//()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()


//()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()
// Valida el Fax Seleccionado
ls_selected = sle_selected.text

//06/28/2012
li_selected_index = lb_faxes.SelectedIndex()

if not cbx_nofax.checked and not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
	MessageBox("Error","El FAX ya fue catalogado/movido la lista sera refrescada",StopSign!)
	cb_refresh.triggerEvent(Clicked!)
	setfocus(lb_faxes)
	return
end if

if not cbx_nofax.checked then
	//if isnull(ls_selected) or len(ls_selected) < 1 then
	if lb_faxes.SelectedIndex() < 1 then
	
		MessageBox("Error","Debe seleccionar un FAX de la lista",StopSign!)
		setfocus(lb_faxes)
		return		
	end if
	ls_desc_release = 'RELEASED W/FAX: '+ls_selected
else
	if len(trim(sle_nofax.text)) < 5 then
		MessageBox("Error","Debe indicar una razon por la cual no hay un FAX para liberar el envio",StopSign!)
		setfocus(sle_nofax)
		return						
	end if	
	ls_selected = "-none-"
	ls_desc_release = 'NO FAX: '+trim(sle_nofax.text)
end if
//()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()



//()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()
// Liberando la orden - Moviendo el Fax

if messagebox("Confirmacion","Esta seguro que desea liberar la orden "+trim(ls_branch)+'-'+trim(ls_invoice)+" ?",Question!,YesNo!) <> 1 Then
	return
end if


if ls_selected <> "-none-" then
	
	// Moviendo el Fax a la carpeta deseada
	if sle_selected.text <> "[No Fax Selected]" then
		
		ls_faxpath = is_faxpath
		ls_newfaxfolder = "u:\RedPhone\Processed\"
		ls_faxname = sle_selected.text
		ls_newfaxname = "0_"+trim(ls_branch)+"_"+trim(ls_invoice)+"_"+string(today(),"mmddyyyyhhmmss")+".tif"
		
		if FileExists(ls_faxpath+ls_faxname) then					
			fn_filemove(ls_faxpath+ls_faxname,ls_newfaxfolder+ls_newfaxname)										
		end if
		
	end if
	
end if


// Si hay firma seleccionada
if lb_firmas.SelectedIndex() > 0 and fileexists(is_signaturespath+lb_firmas.SelectedItem()) then

	ls_signaturefilename = lb_firmas.SelectedItem()

	insert into DBA.RECEIVER_RP_SIGN(ID_BRANCH,ID_RECEIVER,SIGNATURE_FILE)
	values (:ls_branch,:ls_invoice,:ls_signaturefilename);

end if


if left(ls_branch,1) = 'R' then

	UPDATE  DBA.VCW_SALES_PRODUCTS 
	SET STATUSID = 'A'
	WHERE STATUSID = 'H'
	AND IDBRANCH = :ls_branch
	AND SALESID = :ld_receiver;


	if SQLCA.SqlCode <> 0 then
		MessageBox("Error","Error actualizando Status."+char(10)+SQLCA.SQLErrText)
		Return
	end if

else
	
	// Quita el motivo hold y lo pasa a la historia
	// NO LOCK added 06/27/2013
	SELECT id_sender
	into :ld_sender
	FROM DBA.RECEIVER WITH (NOLOCK)
	WHERE DBA.RECEIVER.ID_BRANCH = :ls_branch
	AND DBA.RECEIVER.ID_RECEIVER = :ld_receiver;
	
	ls_desc_release = left(ls_desc_release,50)
	
	INSERT INTO dba.motivo_hold_history  
	(id_sender,   
	id_branch,   
	id_receiver,   
	date_motivo_hold,   
	time_motivo_hold,   
	type_motivo_hold,   
	desc_motivo_hold,   
	id_cashier,   
	date_release,   
	time_release )  
	VALUES (:ld_sender,   
	:ls_branch,   
	:ld_receiver,   
	getdate(),   
	getdate(),   
	'70',   
	:ls_desc_release,
	:gs_cashier,   
	getdate(),   
	getdate());
	
	if SQLCA.SqlCode <> 0 then
		MessageBox("Error","Error Insertando Historia del HOLD."+char(10)+SQLCA.SQLErrText)
		Return
	else
	
		// Borra el motivo HOLD de RP
		DELETE FROM dba.motivo_hold  
		WHERE dba.motivo_hold.id_branch = :ls_branch
		AND dba.motivo_hold.id_receiver = :ld_receiver
		AND dba.motivo_hold.type_motivo_hold = '70';
	
		// Revisa si era el ultimo HOLD
		SELECT Count(*)  
		INTO :ll_cont  
		FROM dba.motivo_hold  
		WHERE dba.motivo_hold.id_branch = :ls_branch
		AND dba.motivo_hold.id_receiver = :ld_receiver;
		
		if ll_cont = 0 then
									
			// Revisa si la orden continua en HOLD
			SELECT ID_FLAG_RECEIVER
			INTO :ls_current_flag
			FROM dba.receiver
			WHERE dba.receiver.id_branch = :ls_branch
			AND dba.receiver.id_receiver = :ld_receiver;
	
			if ls_current_flag = 'H' then
			
				// Cambia el status y la marca para transmision
				UPDATE dba.receiver  
				SET dba.receiver.id_flag_receiver = 'I',
				dba.receiver.trans_receiver = 'N'
				WHERE dba.receiver.id_branch = :ls_branch
				AND dba.receiver.id_receiver = :ld_receiver;
	
				if SQLCA.SQLCODE <> 0 THEN	
					MessageBox("Error","Error Cambiando el status de la orden."+char(10)+SQLCA.SQLErrText)
					Return
				else
					
					// Graba la historia del status
					INSERT INTO dba.history_invoice ( id_branch,id_receiver,id_flag_old,id_flag_new,id_cashier,date_change,time_change )
					VALUES (:ls_branch,:ld_receiver,'H','I',:gs_cashier,getdate(),getdate());
		
					if SQLCA.SQLCODE <> 0 THEN	
						MessageBox("Error","Error Insertando Invoice_History."+char(10)+SQLCA.SQLErrText)
					end if
		
					// Graba la historia de la liberacion
					INSERT INTO dba.change_status_invoice ( id_branch,id_receiver,id_cashier,fecha,hora,id_flag_receiver_old,id_flag_receiver_new )
					VALUES ( :ls_branch,:ld_receiver,:gs_cashier,getdate(),getdate(),'H','I' );
		
					if SQLCA.SQLCODE <> 0 THEN	
						MessageBox("Error","Error Insertando Change_Status."+char(10)+SQLCA.SQLErrText)
					end if			
		
				end if
	
			end if
	
		end if
	
	end if

end if

//()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()

// Refresca la pantalla
cb_refresh.triggerevent(Clicked!)

Messagebox("Proceso Terminado","Liberacion de Telefono Rojo Satisfactoria")

em_branch.text = ""
em_invoice.text = ""

lb_faxes.SelectItem(li_selected_index)
lb_faxes.triggerevent(SelectionChanged!)




end event

type cb_cancel from commandbutton within w_faxviewer_telefonorojo
integer x = 4037
integer y = 12
integer width = 475
integer height = 84
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "&Close"
boolean cancel = true
end type

event clicked;//CloseWithReturn(parent,"-none-")

close(parent)

end event

type gb_2 from groupbox within w_faxviewer_telefonorojo
integer x = 4037
integer y = 1168
integer width = 475
integer height = 368
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Mover Fax a"
end type

type cb_rotateleft from commandbutton within w_faxviewer_telefonorojo
integer x = 4165
integer y = 480
integer width = 101
integer height = 72
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "<"
end type

event clicked;TRY

	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
		MessageBox("Error","The file was already moved",StopSign!)
		cb_refresh.triggerEvent(Clicked!)
		return
	end if
	
	fn_rotatefax(is_faxpath,lb_faxes.SelectedItem(),270)
	
	
	
//	ole_fax1.object.Rotate270
//	
//	String ls_newfilename	
//	ls_newfilename = is_faxpath + 'temp\' + lb_faxes.SelectedItem()
//	ls_newfilename = mid(ls_newfilename,1,len(ls_newfilename)-4)	
//	ole_fax1.object.TIFCompression = 2	
//	//ole_fax1.object.ImageViewer1.JPEGQuality=90
//	ole_fax1.object.Save(ls_newfilename,"JPG")
//	
//	//ole_fax1.object.SaveTIF(ls_newfilename)
//	
//	//fn_loadfax(ls_newfilename)
	
CATCH (runtimeerror er)   

	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
	cb_refresh.TriggerEvent(Clicked!)

FINALLY   
   	
	Return
	
END TRY 



//TRY 
//	
//	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
//		MessageBox("Error","The file was already moved",StopSign!)
//		cb_refresh.triggerEvent(Clicked!)
//		return
//	end if
//	
//	if isnull(ole_fax.object.image) or len(trim(string(ole_fax.object.image))) < 1 then
//		return
//	end if
//	
//	ole_fax.object.RotateLeft
//	ole_fax.object.Save
//	
//CATCH (runtimeerror er)   
//
//   //MessageBox("Runtime Error", er.GetMessage())
//	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
//	cb_refresh.TriggerEvent(Clicked!)
//
//FINALLY   
//   	
//	Return
//	
//END TRY 
end event

type st_branch from statictext within w_faxviewer_telefonorojo
integer x = 4037
integer y = 104
integer width = 494
integer height = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 80269524
boolean enabled = false
string text = "Envio Seleccionado:"
boolean focusrectangle = false
end type

type cb_2 from commandbutton within w_faxviewer_telefonorojo
integer x = 4379
integer y = 708
integer width = 101
integer height = 72
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = ">"
end type

event clicked;TRY

	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
		MessageBox("Error","The file was already moved",StopSign!)
		cb_refresh.triggerEvent(Clicked!)
		return
	end if
	
	if ll_curpage < ole_fax1.object.GetTotalPage then
		ll_curpage = ll_curpage + 1
		ole_fax1.object.LoadMultiPage( is_faxpath+lb_faxes.SelectedItem(),ll_curpage)		
	end if
	
	sle_pos.text = String(ll_curpage)+"/"+string(ole_fax1.object.GetTotalPage)
	
CATCH (runtimeerror er)   

	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
	cb_refresh.TriggerEvent(Clicked!)

FINALLY   
   	
	Return
	
END TRY 



//TRY
//
//	integer li_current
//	
//	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
//		MessageBox("Error","The file was already moved",StopSign!)
//		cb_refresh.triggerEvent(Clicked!)
//		return
//	end if
//	
//	if isnull(ole_fax.object.image) or len(trim(string(ole_fax.object.image))) < 1 then
//		return
//	end if
//	
//	// ole_fax.object.PageCount
//	li_current = ole_fax.object.Page
//	
//	if li_current < ole_fax.object.PageCount then
//		li_current = li_current + 1
//		ole_fax.object.Page = li_current
//		ole_fax.object.display
//	end if
//	
//	sle_pos.text = String(ole_fax.object.Page)+"/"+string(ole_fax.object.PageCount)
//	
//CATCH (runtimeerror er)   
//
//   //MessageBox("Runtime Error", er.GetMessage())
//	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
//	cb_refresh.TriggerEvent(Clicked!)
//
//FINALLY   
//   	
//	Return
//	
//END TRY 
end event

type cb_rrr from commandbutton within w_faxviewer_telefonorojo
integer x = 4165
integer y = 708
integer width = 101
integer height = 72
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "<"
end type

event clicked;TRY

	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
		MessageBox("Error","The file was already moved",StopSign!)
		cb_refresh.triggerEvent(Clicked!)
		return
	end if
	
	if ll_curpage > 1 then
		ll_curpage = ll_curpage - 1
		ole_fax1.object.LoadMultiPage( is_faxpath+lb_faxes.SelectedItem(),ll_curpage)		
	end if
	
	sle_pos.text = String(ll_curpage)+"/"+string(ole_fax1.object.GetTotalPage)
	
CATCH (runtimeerror er)   

	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
	cb_refresh.TriggerEvent(Clicked!)

FINALLY   
   	
	Return
	
END TRY 



//TRY
//
//	integer li_current
//	
//	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
//		MessageBox("Error","The file was already moved",StopSign!)
//		cb_refresh.triggerEvent(Clicked!)
//		return
//	end if
//	
//	if isnull(ole_fax.object.image) or len(trim(string(ole_fax.object.image))) < 1 then
//		return
//	end if
//	
//	// ole_fax.object.PageCount
//	li_current = ole_fax.object.Page
//	
//	if li_current > 1 then
//		li_current = li_current - 1
//		ole_fax.object.Page = li_current
//		ole_fax.object.display
//	end if
//	
//	sle_pos.text = String(ole_fax.object.Page)+"/"+string(ole_fax.object.PageCount)
//	
//CATCH (runtimeerror er)   
//
//   //MessageBox("Runtime Error", er.GetMessage())
//	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
//	cb_refresh.TriggerEvent(Clicked!)
//
//FINALLY   
//   	
//	Return
//	
//END TRY 
end event

type cb_4 from commandbutton within w_faxviewer_telefonorojo
integer x = 4064
integer y = 1020
integer width = 425
integer height = 88
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Imprimir Pagina"
end type

event clicked;TRY

	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
		MessageBox("Error","The file was already moved",StopSign!)
		cb_refresh.triggerEvent(Clicked!)
		return
	end if

	ole_fax1.object.PrintImage(true)

CATCH (runtimeerror er)   

	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
	cb_refresh.TriggerEvent(Clicked!)

FINALLY   
   	
	Return
	
END TRY 




//TRY
//
//	if isnull(ole_fax.object.image) or len(trim(string(ole_fax.object.image))) < 1 then
//		return
//	end if
//	ole_fax.object.PrintImage(ole_fax.object.Page,ole_fax.object.Page)
//
//CATCH (runtimeerror er)   
//
//   //MessageBox("Runtime Error", er.GetMessage())
//	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
//	cb_refresh.TriggerEvent(Clicked!)
//
//FINALLY   
//   	
//	Return
//	
//END TRY 


end event

type em_branch from editmask within w_faxviewer_telefonorojo
integer x = 4037
integer y = 168
integer width = 475
integer height = 104
boolean bringtotop = true
integer textsize = -14
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 16777215
maskdatatype maskdatatype = stringmask!
string mask = "!!!!!!!!!!"
end type

event losefocus;long ll_cont
String ls_branch

ls_branch = em_branch.text

select count(*) into :ll_cont
from dba.branch where id_branch = :ls_branch;

if ll_cont < 1 then 
	st_branch.TextColor = RGB(255,0,0)
else
	st_branch.TextColor = RGB(0,0,0)
end if
end event

type cb_rotate180 from commandbutton within w_faxviewer_telefonorojo
integer x = 4274
integer y = 480
integer width = 101
integer height = 72
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "[]"
end type

event clicked;TRY

	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
		MessageBox("Error","The file was already moved",StopSign!)
		cb_refresh.triggerEvent(Clicked!)
		return
	end if
		
	fn_rotatefax(is_faxpath,lb_faxes.SelectedItem(),180)	
	
//	ole_fax1.object.Rotate90
//	
//	String ls_newfilename	
//	ls_newfilename = is_faxpath + 'temp\' + lb_faxes.SelectedItem()
//	ls_newfilename = mid(ls_newfilename,1,len(ls_newfilename)-4)	
//	//ole_fax1.object.TIFCompression = 2	
//	//ole_fax1.object.ImageViewer1.JPEGQuality=90
//	ole_fax1.object.Save(ls_newfilename,"JPG")
//	
//	//ole_fax1.object.SaveTIF(ls_newfilename)
//	
//	//fn_loadfax(ls_newfilename)
	
CATCH (runtimeerror er)   

	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
	cb_refresh.TriggerEvent(Clicked!)

FINALLY   
   	
	Return
	
END TRY 




//TRY
//
//	if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
//		MessageBox("Error","The file was already moved",StopSign!)
//		cb_refresh.triggerEvent(Clicked!)
//		return
//	end if
//	
//	if isnull(ole_fax.object.image) or len(trim(string(ole_fax.object.image))) < 1 then
//		return
//	end if
//	
//	ole_fax.object.RotateRight
//	ole_fax.object.Save
//	
//CATCH (runtimeerror er)   
//
//   //MessageBox("Runtime Error", er.GetMessage())
//	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
//	cb_refresh.TriggerEvent(Clicked!)
//
//FINALLY   
//   	
//	Return
//	
//END TRY 
end event

type st_4 from statictext within w_faxviewer_telefonorojo
integer x = 4069
integer y = 488
integer width = 114
integer height = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
boolean enabled = false
string text = "Rot."
boolean focusrectangle = false
end type

type st_5 from statictext within w_faxviewer_telefonorojo
integer x = 4069
integer y = 604
integer width = 91
integer height = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
boolean enabled = false
string text = "Zm."
boolean focusrectangle = false
end type

type st_6 from statictext within w_faxviewer_telefonorojo
integer x = 4069
integer y = 716
integer width = 82
integer height = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
boolean enabled = false
string text = "Pg."
boolean focusrectangle = false
end type

type sle_pos from singlelineedit within w_faxviewer_telefonorojo
integer x = 4265
integer y = 708
integer width = 114
integer height = 72
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 16777215
string text = "1/1"
boolean autohscroll = false
boolean displayonly = true
end type

type cb_refresh from commandbutton within w_faxviewer_telefonorojo
integer x = 9
integer width = 690
integer height = 84
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Refrescar"
end type

event clicked;lb_faxes.DirList(is_faxpath + "*.TIF", 0)


// >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
// Cleaning Screen
sle_pos.TextColor	= RGB(0,0,0)
sle_pos.text = "1/1"
sle_zoom.text = '50'
sle_selected.text = "[No Fax Selected]"
sle_newname.text = ""
ole_fax1.object.FileName = ""
// >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>


dw_pos.reset()
dw_pos.retrieve()

dw_invoices.reset()
dw_invoices.retrieve()
st_count.text = String(dw_invoices.rowcount())

lb_firmas.reset()
//ole_signature.object.ClearDisplay()
ole_signature1.object.FileName = ''

cbx_nofax.checked = false
sle_nofax.text = ''

sle_filter.text = ''
dw_invoices.SetFilter('')
dw_invoices.Filter()

cbx_nosignature.checked = false
cb_separate.enabled = false



SetFocus(st_menurapido)

end event

type cb_printall from commandbutton within w_faxviewer_telefonorojo
integer x = 4064
integer y = 920
integer width = 425
integer height = 88
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Imprimir Todo"
end type

event clicked;
Messagebox("","Esta opción no ha sido implementada aun...")

//TRY
//
//	if isnull(ole_fax.object.image) or len(trim(string(ole_fax.object.image))) < 1 then
//		return
//	end if
//	ole_fax.object.PrintImage(1,ole_fax.object.PageCount)
//
//
//CATCH (runtimeerror er)   
//
//   //MessageBox("Runtime Error", er.GetMessage())
//	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
//	cb_refresh.TriggerEvent(Clicked!)
//
//FINALLY   
//   	
//	Return
//	
//END TRY 
end event

type cb_move from commandbutton within w_faxviewer_telefonorojo
integer x = 4059
integer y = 1412
integer width = 430
integer height = 84
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "&Mover"
end type

event clicked;TRY
	
	// Moviendo el Fax a la carpeta deseada
	if sle_selected.text <> "[No Fax Selected]" then
	
		if	"RedPhone" = lb_movetofolder.text then
			Messagebox("","You must specify a diffrent Folder to Move the fax",StopSign!)
			return
		end if	
	
		String ls_faxpath, ls_faxname, ls_newfaxfolder, ls_newfaxname
	
		ls_faxpath = is_faxpath
		ls_newfaxfolder = "u:\"+lb_movetofolder.text+"\"
		ls_faxname = sle_selected.text
		ls_newfaxname = sle_newname.text
	
		if isnull(ls_newfaxname) or len(trim(ls_newfaxname)) < 1 then 
			ls_newfaxname = ls_faxname
			sle_newname.text = ls_newfaxname
		end if
	
		if messagebox("Confirm","Are you sure that your want to move the fax " + sle_selected.text + " to "+ls_newfaxfolder+"?",Question!,YesNo!) <> 1 Then
			return
		end if
		if FileExists(ls_faxpath+ls_faxname) then
			//if FileExists(ls_newfaxfolder+ls_newfaxname) then
				//ls_newfaxname = fn_replace(ls_newfaxname,".tif","") + "_" + string(today(),'mmddyyhhmmss')+".tif"			
			//end if
			//ls_newfaxname = string(today(),'mmddyyhhmmss')+'_'+gs_login+'_'+ls_newfaxname
			ls_newfaxname = fn_replace(upper(ls_newfaxname),".TIF","") + "_"+gs_login+'_'+ string(today(),'mmddyyhhmmss')+".tif"
			fn_filemove(ls_faxpath+ls_faxname,ls_newfaxfolder+ls_newfaxname)										
		end if
	end if
	ole_fax1.object.FileName = ""
	lb_faxes.DirList(is_faxpath + "*.TIF", 0)
	
	// >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
	// Cleaning Screen
	sle_pos.TextColor	= RGB(0,0,0)
	sle_pos.text = "1/1"
	sle_zoom.text = '50'
	sle_selected.text = "[No Fax Selected]"
	sle_newname.text = ""
	ole_fax1.object.FileName = ""
	// >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

	
CATCH (runtimeerror er)   

	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
	cb_refresh.TriggerEvent(Clicked!)

FINALLY   
   	
	Return
	
END TRY 	



//TRY
//
//	// Moviendo el Fax a la carpeta deseada
//	if sle_selected.text <> "[No Fax Selected]" then
//	
//		String ls_faxpath, ls_faxname, ls_newfaxfolder, ls_newfaxname
//	
//		if not fileexists(is_faxpath+lb_faxes.SelectedItem()) then
//			MessageBox("Error","The file was already moved",StopSign!)
//			cb_refresh.triggerEvent(Clicked!)
//			return
//		end if
//	
//		ls_faxpath = is_faxpath
//		ls_newfaxfolder = "u:\"+lb_movetofolder.text+"\"
//		ls_faxname = sle_selected.text
//		ls_newfaxname = sle_newname.text
//		
//		if messagebox("Confirm","Are you sure that your want to move the fax " + sle_selected.text + " to "+ls_newfaxfolder+"?",Question!,YesNo!) <> 1 Then
//			return
//		end if
////		if FileExists(ls_faxpath+ls_faxname) then					
////			fn_filemove(ls_faxpath+ls_faxname,ls_newfaxfolder+string(today(),'mmddyyhhmmss')+'_'+gs_login+'_'+ls_faxname)										
////		end if
//		if FileExists(ls_faxpath+ls_faxname) then
//		//if FileExists(ls_newfaxfolder+ls_newfaxname) then
//			//ls_newfaxname = fn_replace(ls_newfaxname,".tif","") + "_" + string(today(),'mmddyyhhmmss')+".tif"			
//		//end if
//		//ls_newfaxname = string(today(),'mmddyyhhmmss')+'_'+gs_login+'_'+ls_newfaxname
//		ls_newfaxname = fn_replace(ls_newfaxname,".tif","") + "_"+gs_login+'_'+ string(today(),'mmddyyhhmmss')+".tif"
//		fn_filemove(ls_faxpath+ls_faxname,ls_newfaxfolder+ls_newfaxname)										
//	end if
//		
//	end if
//	ole_fax.object.ClearDisplay
//	lb_faxes.DirList(is_faxpath + "*.TIF", 0)
//	
//	// >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
//	// Cleaning Screen
//	sle_pos.TextColor	= RGB(0,0,0)
//	sle_pos.text = "1/1"
//	sle_zoom.text = '50'
//	sle_selected.text = "[No Fax Selected]"
//	sle_newname.text = ""
//	ole_fax.object.ClearDisplay()
//	// >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
//	
//CATCH (runtimeerror er)   
//
//   //MessageBox("Runtime Error", er.GetMessage())
//	Messagebox("Error (try block)","Este fax ya ha sido movido, la lista sera actualizada!",Exclamation!)
//	cb_refresh.TriggerEvent(Clicked!)
//
//FINALLY   
//   	
//	Return
//	
//END TRY 	
end event

type lb_movetofolder from dropdownlistbox within w_faxviewer_telefonorojo
integer x = 4059
integer y = 1316
integer width = 430
integer height = 492
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean vscrollbar = true
string item[] = {"Ach","Applications","Compliance","Corporate","Corporate\Processed","Junk","RedPhone","Accounting","Inbox","Marketing"}
borderstyle borderstyle = stylelowered!
end type

type st_1 from statictext within w_faxviewer_telefonorojo
integer x = 3863
integer y = 2012
integer width = 494
integer height = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
boolean enabled = false
string text = "Fax Seleccionado:"
boolean focusrectangle = false
end type

type gb_1 from groupbox within w_faxviewer_telefonorojo
integer x = 9
integer y = 84
integer width = 690
integer height = 900
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
end type

type gb_3 from groupbox within w_faxviewer_telefonorojo
integer x = 9
integer y = 964
integer width = 690
integer height = 972
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
end type

type gb_4 from groupbox within w_faxviewer_telefonorojo
integer x = 4037
integer y = 388
integer width = 475
integer height = 752
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Opciones Fax"
end type

type gb_5 from groupbox within w_faxviewer_telefonorojo
integer x = 713
integer y = 1820
integer width = 1499
integer height = 480
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
end type

type p_1 from picture within w_faxviewer_telefonorojo
integer x = 4421
integer y = 24
integer width = 73
integer height = 64
boolean bringtotop = true
boolean originalsize = true
string picturename = "Exit!"
boolean focusrectangle = false
boolean map3dcolors = true
end type

event clicked;//cb_cancel.triggerevent(Clicked!)

close(parent)
end event

type ole_fax1 from olecustomcontrol within w_faxviewer_telefonorojo
event click ( )
event dblclick ( )
event mousemove ( integer button,  integer shift,  long ocx_x,  long ocx_y )
event mousedown ( integer button,  integer shift,  long ocx_x,  long ocx_y )
event mouseup ( integer button,  integer shift,  long ocx_x,  long ocx_y )
event keydown ( integer keycode,  integer shift )
event keyup ( integer keycode,  integer shift )
event keypress ( integer keyascii )
event selectionrectdrawn ( long ileft,  long itop,  long iwidth,  long iheight )
event ocrrecognized ( boolean bsuccess )
integer x = 713
integer y = 8
integer width = 3291
integer height = 1820
boolean border = false
borderstyle borderstyle = stylelowered!
string binarykey = "w_faxviewer_telefonorojo.win"
integer binaryindex = 2
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
end type

event click();SetFocus(st_menurapido)
end event

type em_invoice from editmask within w_faxviewer_telefonorojo
integer x = 4037
integer y = 272
integer width = 475
integer height = 104
boolean bringtotop = true
integer textsize = -14
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 16777215
maskdatatype maskdatatype = stringmask!
string mask = "##########"
end type

event losefocus;long ll_cont
String ls_branch

ls_branch = em_branch.text

select count(*) into :ll_cont
from dba.branch where id_branch = :ls_branch;

if ll_cont < 1 then 
	st_branch.TextColor = RGB(255,0,0)
else
	st_branch.TextColor = RGB(0,0,0)
end if
end event


Start of PowerBuilder Binary Data Section : Do NOT Edit
03w_faxviewer_telefonorojo.bin 
2D00000c00e011cfd0e11ab1a1000000000000000000000000000000000003003e0009fffe000000060000000000000000000000010000000100000000000010000000000200000001fffffffe0000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd00000004fffffffefffffffefffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff006f00520074006f004500200074006e00790072000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000050016ffffffffffffffff0000000300000000000000000000000000000000000000000000000000000000e575313001d235f800000003000001800000000000500003004c004200430049004e0045004500530045004b000000590000000000000000000000000000000000000000000000000000000000000000000000000002001cffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c0000000000500003004f0042005800430054005300450052004d0041000000000000000000000000000000000000000000000000000000000000000000000000000000000002001affffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000001000000d400000000004200500043004f00530058004f00540041005200450047000000000000000000000000000000000000000000000000000000000000000000000000000000000101001a000000020000000100000004e589da784fc5ad4c479eb9b69e6710b100000000e575313001d235f8e575313001d235f8000000000000000000000000fffffffe000000020000000300000004fffffffefffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
26ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0065004400650076006f006c00650070002000720069006c006500630073006e003a0065003600350033003700000000000000000000000000000000000000000000fffe00020206e589da784fc5ad4c479eb9b69e6710b100000001fb8f0821101b01640008ed8413c72e2b00000030000000a40000000500000100000000300000010100000038000001020000004000000103000000480000000000000050000000030001000000000003000024cb0000000300000bc800000003000000000000000500000000000000010001030000000c0074735f00706b636f73706f72000101000000090078655f00746e65740102007800090000655f00006e65747800007974090000015f00000073726576006e6f69000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000024cb00000bc800000000000001010000000000000000000000006564040000646f6d0000000000000000000001006000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006f00430074006e006e00650073007400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001020012ffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000500000039000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600e011cfd0e11ab1a1000000000000000000000000000000000003003e0009fffe00000006000000000000000000000001000000010000000000001000fffffffe00000000fffffffe0000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdfffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
2Effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff006f00520074006f004500200074006e00790072000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000050016ffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000fffffffe00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00e011cfd0e11ab1a1000000000000000000000000000000000003003e0009fffe000000060000000000000000000000010000000100000000000010000000000200000001fffffffe0000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd00000004fffffffefffffffefffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff006f00520074006f004500200074006e00790072000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000050016ffffffffffffffff0000000300000000000000000000000000000000000000000000000000000000e575313001d235f800000003000001800000000000500003004c004200430049004e0045004500530045004b000000590000000000000000000000000000000000000000000000000000000000000000000000000002001cffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c0000000000500003004f0042005800430054005300450052004d0041000000000000000000000000000000000000000000000000000000000000000000000000000000000002001affffffffffffffffffffffff0000000000000000
200000000000000000000000000000000000000000000000000000000000000001000000d400000000004200500043004f00530058004f00540041005200450047000000000000000000000000000000000000000000000000000000000000000000000000000000000101001a000000020000000100000004e589da784fc5ad4c479eb9b69e6710b100000000e575313001d235f8e575313001d235f8000000000000000000000000fffffffe000000020000000300000004fffffffefffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0065004400650076006f006c00650070002000720069006c006500630073006e003a0065003600350033003700000000000000000000000000000000000000000000fffe00020206e589da784fc5ad4c479eb9b69e6710b100000001fb8f0821101b01640008ed8413c72e2b00000030000000a4000000050000010000000030000001010000003800000102000000400000010300000048000000000000005000000003000100000000000300004a6a0000000300002f0700000003000000000000000500000000000000010001030000000c0074735f00706b636f73706f72000101000000090078655f00746e65740102007800090000655f00006e65747800007974090000015f00000073726576006e6f6900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000004a6a00002f0700000000000001010000000000000000000000006564040000646f6d0000000000000000000001006000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006f00430074006e006e00650073007400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001020012ffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000500000039000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
13w_faxviewer_telefonorojo.bin 
End of PowerBuilder Binary Data Section : No Source Expected After This Point
